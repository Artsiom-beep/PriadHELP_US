MELT — ПРЕОБРАЗОВАНИЕ ДАННЫХ (PANDAS)

1. Что такое melt

melt — это операция изменения структуры таблицы.
Она превращает данные из «широкого» формата в «длинный».

Широкий формат:
- значения одной переменной хранятся в названиях колонок

Длинный формат:
- каждая строка — одно наблюдение
- значения переменной хранятся в отдельной колонке


2. Зачем нужен melt

Анализ данных, группировка, статистика и визуализация
работают корректно только с длинным форматом.

Без melt:
- сложно использовать groupby
- невозможно удобно строить графики
- приходится писать лишний код

С melt:
- данные становятся «tidy»
- каждая переменная — отдельная колонка
- каждая строка — одно наблюдение


3. Пример проблемы

Dane w formacie szerokim:

data        USD    EUR    GBP
2020-01-01  3.80   4.20   4.90
2020-01-02  3.82   4.21   4.88

Здесь валюта — это не колонка, а имя колонки.
Это неудобно для анализа.


4. Результат melt

data        waluta  kurs
2020-01-01  USD     3.80
2020-01-01  EUR     4.20
2020-01-01  GBP     4.90
2020-01-02  USD     3.82
2020-01-02  EUR     4.21
2020-01-02  GBP     4.88

Теперь:
- waluta — обычная колонка
- kurs — обычная колонка
- каждая строка — одно измерение


5. Синтаксис melt

pd.melt(
    frame,
    id_vars,
    value_vars,
    var_name,
    value_name
)


6. Основные параметры

frame
- исходная таблица

id_vars
- колонки, которые остаются без изменений
- идентификаторы наблюдений (например дата)

value_vars
- колонки, которые нужно «расплавить»
- если не указаны, используются все кроме id_vars

var_name
- имя новой колонки с названиями старых колонок

value_name
- имя новой колонки со значениями


7. Пример кода

df_long = df.melt(
    id_vars=["data"],
    var_name="waluta",
    value_name="kurs"
)


8. Что происходит внутри

1) колонка data копируется без изменений
2) колонки USD, EUR, GBP исчезают
3) их имена попадают в колонку waluta
4) значения попадают в колонку kurs
5) число строк увеличивается


9. Почему это важно

После melt можно:

- группировать по waluta
- считать średnią, medianę, odchylenie
- строить wykresy w seaborn
- анализировать zmienność w czasie


10. Ключевая идея

Если переменная находится в названиях колонок —
это сигнал, что нужен melt.

melt не меняет данные.
Он меняет структуру и точку зрения на данные.
